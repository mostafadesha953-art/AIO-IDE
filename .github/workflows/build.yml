name: Global_Search_Build
on: [push]
jobs:
  build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4

    - name: Find and Fix File Locations
      shell: pwsh
      run: |
        # البحث عن مكان ملف main.cpp الحقيقي
        $mainFile = Get-ChildItem -Filter "main.cpp" -Recurse | Select-Object -First 1
        if ($null -eq $mainFile) { throw "Could not find main.cpp in the repository!" }
        
        $rootPath = $mainFile.DirectoryName
        echo "Files found in: $rootPath"
        
        # الانتقال لمجلد الملفات وتثبيت المكتبات
        cd $rootPath
        vcpkg install curl:x64-windows nlohmann-json:x64-windows

    - name: Configure and Build
      shell: pwsh
      run: |
        $cmakeFile = Get-ChildItem -Filter "CMakeLists.txt" -Recurse | Select-Object -First 1
        cd $cmakeFile.DirectoryName
        cmake -S . -B build -DCMAKE_TOOLCHAIN_FILE="$env:VCPKG_INSTALLATION_ROOT/scripts/buildsystems/vcpkg.cmake"
        cmake --build build --config Release

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: AIO_IDE_Final
        path: "**/build/Release/AIO_IDE.exe"
